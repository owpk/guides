var Perfume=function(){function t(t){var i=this;if(void 0===t&&(t={}),this.config={firstContentfulPaint:!1,firstPaint:!1,firstInputDelay:!1,dataConsumption:!1,largestContentfulPaint:!1,navigationTiming:!1,networkInformation:!1,resourceTiming:!1,analyticsTracker:function(t){},logPrefix:"Perfume.js:",logging:!0,maxMeasureTime:15e3},this.c=window.console,this.d=document,this.t=!1,this.i=0,this.s="Recording already",this.h={},this.o={},this.u={beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0},this.w=window,this.m=window.performance,this.v=window.navigator,this.l=function(){i.d.hidden&&(i.t=i.d.hidden)},this.config=Object.assign({},this.config,t),this.p()){if(this.g())try{this.T()}catch(t){this.config.logging&&this.c.warn(this.config.logPrefix,t)}this.P(),this.config.navigationTiming&&this.k("navigationTiming",this._()),this.config.networkInformation&&this.k("networkInformation",this.N())}}return t.prototype.start=function(t){this.p()&&(this.h[t]?this.C(this.s+" started."):(this.h[t]=!0,this.m.mark("mark_"+t+"_start"),this.t=!1))},t.prototype.end=function(t,i){var n=this;if(void 0===i&&(i={}),this.p())if(this.h[t]){this.m.mark("mark_"+t+"_end");var s=this.I(t),e=parseFloat(s.toFixed(2));delete this.h[t],this.j((function(){var s={D:t,data:e,duration:e,F:i};n.log(s),n.L(s)}))}else this.C(this.s+" stopped.")},t.prototype.endPaint=function(t,i){var n=this;setTimeout((function(){n.end(t,i)}))},t.prototype.clear=function(t){this.m.clearMarks("mark_"+t+"_start"),this.m.clearMarks("mark_"+t+"_end"),delete this.h[t]},t.prototype.O=function(t){this.q({B:t,D:"firstInputDelay",M:"duration"}),this.R(),this.S()},t.prototype.S=function(){this.A&&(clearTimeout(this.A),this.A=void 0,this.k("dataConsumption",this.u))},t.prototype.R=function(){this.o.G&&this.i&&(this.H(this.i,"largestContentfulPaint"),this.o.G.disconnect())},t.prototype.J=function(){this.o.K=this.U("first-input",this.O.bind(this))},t.prototype.V=function(){var t=this;this.o.W=this.U("paint",(function(i){t.q({B:i,X:"first-paint",D:"firstPaint",M:"startTime"}),t.q({B:i,X:"first-contentful-paint",D:"firstContentfulPaint",M:"startTime"})}))},t.prototype.Y=function(){var t=this;this.o.G=this.U("largest-contentful-paint",(function(i){var n=i.pop();n&&(t.i=n.renderTime||n.loadTime)}))},t.prototype.T=function(){(this.config.firstPaint||this.config.firstContentfulPaint)&&this.V(),this.J(),this.Y(),(this.config.resourceTiming||this.config.dataConsumption)&&this.Z()},t.prototype.Z=function(){var t=this;this.U("resource",(function(i){t.$({B:i})})),this.A=setTimeout((function(){t.S()}),15e3)},t.prototype.p=function(){return this.m&&!!this.m.getEntriesByType&&!!this.m.now&&!!this.m.mark},t.prototype.g=function(){return this.w.chrome&&"PerformanceObserver"in this.w},t.prototype.tt=function(t){var i=this.m.getEntriesByName(t),n=i[i.length-1];return n&&"measure"===n.entryType?n.duration:-1},t.prototype._=function(){if(!this.p())return{};var t=performance.getEntriesByType("navigation")[0];if(!t)return{};var i=t.responseStart,n=t.responseEnd;return{fetchTime:n-t.fetchStart,workerTime:t.workerStart>0?n-t.workerStart:0,totalTime:n-t.requestStart,downloadTime:n-i,timeToFirstByte:i-t.requestStart,headerSize:t.transferSize-t.encodedBodySize||0,dnsLookupTime:t.domainLookupEnd-t.domainLookupStart}},t.prototype.N=function(){if("connection"in this.v){var t=this.v.connection;return"object"!=typeof t?{}:{downlink:t.downlink,effectiveType:t.effectiveType,rtt:t.rtt,saveData:!!t.saveData}}return{}},t.prototype.k=function(t,i){var n=this;Object.keys(i).forEach((function(t){"number"==typeof i[t]&&(i[t]=parseFloat(i[t].toFixed(2)))})),this.j((function(){n.log({D:t,data:i}),n.L({D:t,data:i})}))},t.prototype.H=function(t,i,n){var s=this;void 0===n&&(n="ms");var e=parseFloat(t.toFixed(2));e>this.config.maxMeasureTime||e<=0||this.j((function(){s.log({D:i,data:e+" "+n}),s.L({D:i,duration:e})}))},t.prototype.log=function(t){if(!this.t&&this.config.logging){this.c.log("%c "+this.config.logPrefix+" "+t.D+" ","color:#ff6d00;font-size:11px;",t.data)}},t.prototype.C=function(t){this.config.logging&&this.c.warn(this.config.logPrefix,t)},t.prototype.P=function(){void 0!==this.d.hidden&&this.d.addEventListener("visibilitychange",this.l)},t.prototype.I=function(t){var i="mark_"+t+"_start",n="mark_"+t+"_end";return this.m.measure(t,i,n),this.tt(t)},t.prototype.U=function(t,i){return this.it=new PerformanceObserver((function(t){var n=t.getEntries();i(n)})),this.it.observe({type:t,buffered:!0}),this.it},t.prototype.q=function(t){var i=this;t.B.forEach((function(n){i.config[t.D]&&(!t.X||t.X&&n.name===t.X)&&i.H(n[t.M],t.D),i.o.W&&"first-contentful-paint"===n.name&&i.o.W.disconnect()})),this.o.K&&"firstInputDelay"===t.D&&this.o.K.disconnect()},t.prototype.$=function(t){var i=this;t.B.forEach((function(t){if(i.config.resourceTiming&&i.k("resourceTiming",t),i.config.dataConsumption&&t.decodedBodySize&&t.initiatorType){var n=t.decodedBodySize/1e3;i.u[t.initiatorType]+=n,i.u.total+=n}}))},t.prototype.j=function(t){"requestIdleCallback"in this.w?this.w.requestIdleCallback(t,{timeout:3e3}):t()},t.prototype.L=function(t){if(!this.t){var i=t.D,n=t.data,s=t.duration,e=t.F,r=e||{};this.config.analyticsTracker({metricName:i,data:n,duration:s,eventProperties:r})}},t}();(function(){var h="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,k="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};function l(){l=function(){};h.Symbol||(h.Symbol=m)}var n=0;function m(a){return"jscomp_symbol_"+(a||"")+n++}
function p(){l();var a=h.Symbol.iterator;a||(a=h.Symbol.iterator=h.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&k(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return q(this)}});p=function(){}}function q(a){var b=0;return r(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function r(a){p();a={next:a};a[h.Symbol.iterator]=function(){return this};return a}function t(a){p();var b=a[Symbol.iterator];return b?b.call(a):q(a)}
function u(a){if(!(a instanceof Array)){a=t(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}var v=0;function w(a,b){var c=XMLHttpRequest.prototype.send,d=v++;XMLHttpRequest.prototype.send=function(f){for(var e=[],g=0;g<arguments.length;++g)e[g-0]=arguments[g];var E=this;a(d);this.addEventListener("readystatechange",function(){4===E.readyState&&b(d)});return c.apply(this,e)}}
function x(a,b){var c=fetch;fetch=function(d){for(var f=[],e=0;e<arguments.length;++e)f[e-0]=arguments[e];return new Promise(function(d,e){var g=v++;a(g);c.apply(null,[].concat(u(f))).then(function(a){b(g);d(a)},function(a){b(a);e(a)})})}}var y="img script iframe link audio video source".split(" ");function z(a,b){a=t(a);for(var c=a.next();!c.done;c=a.next())if(c=c.value,b.includes(c.nodeName.toLowerCase())||z(c.children,b))return!0;return!1}
function A(a){var b=new MutationObserver(function(c){c=t(c);for(var b=c.next();!b.done;b=c.next())b=b.value,"childList"==b.type&&z(b.addedNodes,y)?a(b):"attributes"==b.type&&y.includes(b.target.tagName.toLowerCase())&&a(b)});b.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]});return b}
function B(a,b){if(2<a.length)return performance.now();var c=[];b=t(b);for(var d=b.next();!d.done;d=b.next())d=d.value,c.push({timestamp:d.start,type:"requestStart"}),c.push({timestamp:d.end,type:"requestEnd"});b=t(a);for(d=b.next();!d.done;d=b.next())c.push({timestamp:d.value,type:"requestStart"});c.sort(function(a,b){return a.timestamp-b.timestamp});a=a.length;for(b=c.length-1;0<=b;b--)switch(d=c[b],d.type){case "requestStart":a--;break;case "requestEnd":a++;if(2<a)return d.timestamp;break;default:throw Error("Internal Error: This should never happen");}return 0}function C(a){a=a?a:{};this.w=!!a.useMutationObserver;this.u=a.minValue||null;a=window.__tti&&window.__tti.e;var b=window.__tti&&window.__tti.o;this.a=a?a.map(function(a){return{start:a.startTime,end:a.startTime+a.duration}}):[];b&&b.disconnect();this.b=[];this.f=new Map;this.j=null;this.v=-Infinity;this.i=!1;this.h=this.c=this.s=null;w(this.m.bind(this),this.l.bind(this));x(this.m.bind(this),this.l.bind(this));D(this);this.w&&(this.h=A(this.B.bind(this)))}
C.prototype.getFirstConsistentlyInteractive=function(){var a=this;return new Promise(function(b){a.s=b;"complete"==document.readyState?F(a):window.addEventListener("load",function(){F(a)})})};function F(a){a.i=!0;var b=0<a.a.length?a.a[a.a.length-1].end:0,c=B(a.g,a.b);G(a,Math.max(c+5E3,b))}
function G(a,b){!a.i||a.v>b||(clearTimeout(a.j),a.j=setTimeout(function(){var b=performance.timing.navigationStart,d=B(a.g,a.b),b=(window.a&&window.a.A?1E3*window.a.A().C-b:0)||performance.timing.domContentLoadedEventEnd-b;if(a.u)var f=a.u;else performance.timing.domContentLoadedEventEnd?(f=performance.timing,f=f.domContentLoadedEventEnd-f.navigationStart):f=null;var e=performance.now();null===f&&G(a,Math.max(d+5E3,e+1E3));var g=a.a;5E3>e-d?d=null:(d=g.length?g[g.length-1].end:b,d=5E3>e-d?null:Math.max(d,f));d&&(a.s(d),clearTimeout(a.j),a.i=!1,a.c&&a.c.disconnect(),a.h&&a.h.disconnect());G(a,performance.now()+1E3)},b-performance.now()),a.v=b)}
function D(a){a.c=new PerformanceObserver(function(b){b=t(b.getEntries());for(var c=b.next();!c.done;c=b.next())if(c=c.value,"resource"===c.entryType&&(a.b.push({start:c.fetchStart,end:c.responseEnd}),G(a,B(a.g,a.b)+5E3)),"longtask"===c.entryType){var d=c.startTime+c.duration;a.a.push({start:c.startTime,end:d});G(a,d+5E3)}});a.c.observe({entryTypes:["longtask","resource"]})}C.prototype.m=function(a){this.f.set(a,performance.now())};C.prototype.l=function(a){this.f.delete(a)};C.prototype.B=function(){G(this,performance.now()+5E3)};h.Object.defineProperties(C.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(u(this.f.values()))}}});var H={getFirstConsistentlyInteractive:function(a){a=a?a:{};return"PerformanceLongTaskTiming"in window?(new C(a)).getFirstConsistentlyInteractive():Promise.resolve(null)}};"undefined"!=typeof module&&module.exports?module.exports=H:"function"===typeof define&&define.amd?define("ttiPolyfill",[],function(){return H}):window.ttiPolyfill=H;})();window.getCookie=function(name){let match=document.cookie.match(new RegExp('(^| )'+name+'=([^;]+)'));if(match)return match[2];}
window.uuid=(new Date).getTime().toString(16)+Math.floor(1E7*Math.random()).toString(16);window.rstatEndpoint='https://rstat.tproger.ru/wh/upm?requestId='+window.uuid;function sendMetrics(data){fetch(`${window.rstatEndpoint}&${Object.entries(data).map(([key,val])=>`${key}=${val}`).join('&')}`);}
ttiPolyfill.getFirstConsistentlyInteractive().then((tti)=>{sendMetrics({timeToInteractive:tti.toFixed(0)});});function isDownlinkNumber(downlink){return downlink==parseInt(downlink,10);}
const perfume=new Perfume({logging:false,logPrefix:'Performance:',navigationTiming:true,firstPaint:true,firstContentfulPaint:true,firstInputDelay:true,networkInformation:true,analyticsTracker:({metricName,data,duration})=>{if(data&&metricName==='navigationTiming'){sendMetrics({workerTime:data.workerTime,dnsLookupTime:data.dnsLookupTime,downloadTime:data.downloadTime,timeToFirstByte:data.timeToFirstByte.toFixed(0)});}else if(data&&metricName==='networkInformation'){let metrics={effectiveType:data.effectiveType,rtt:data.rtt.toFixed(0)};if(isDownlinkNumber(data.downlink)){metrics.downlink=(data.downlink*1024).toFixed(0);}
sendMetrics(metrics);}else{sendMetrics({[metricName]:duration.toFixed(0)});}}});window.addEventListener('DOMContentLoaded',()=>{const loggedIn=document.body.classList.contains('logged-in')?1:0;sendMetrics({isUserLoggedInToWordpress:loggedIn,cfCacheStatus:window.getCookie('cf_cache_status')});});